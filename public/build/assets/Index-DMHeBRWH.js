import{m as V,d as f,y as D,e as H,p as U,o as _,j as a,f as r,a as t,k as p,t as n,g as S,v as q,z as O,c as w,b as R,F as G,r as J,n as K,q as d}from"./app-DPCJlmDy.js";import{_ as Q}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bt_ij8e5.js";import{_ as W}from"./PageLayout.vue_vue_type_script_setup_true_lang-DLVdu-Rn.js";import{a as c,_ as x}from"./Card.vue_vue_type_script_setup_true_lang-DTGucdqz.js";import{_ as $}from"./Badge.vue_vue_type_script_setup_true_lang-BjnebaBG.js";import{_ as X}from"./Pagination.vue_vue_type_script_setup_true_lang-PXxSz7z-.js";import{u as Y}from"./useToast-Cp7HUmZc.js";/* empty css            */const Z={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-8"},tt={class:"flex items-center gap-3 mt-4 sm:mt-0"},et={class:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8"},st={class:"flex items-center justify-between"},ot={class:"text-2xl font-bold text-text"},at={class:"flex items-center justify-between"},rt={class:"text-2xl font-bold text-success"},nt={class:"flex items-center justify-between"},it={class:"text-2xl font-bold text-danger"},lt={class:"flex flex-col sm:flex-row gap-4"},dt={class:"flex-1"},ct={class:"flex gap-3"},ut={class:"overflow-x-auto"},pt={class:"w-full"},xt={class:"divide-y divide-border"},vt={key:0},mt={class:"px-4 py-3"},gt={class:"flex items-center gap-2"},ft={class:"font-medium text-text"},_t={class:"px-4 py-3"},ht={class:"font-medium text-text"},kt={class:"px-4 py-3"},yt={class:"font-medium text-text"},wt={class:"text-sm text-text-muted"},bt={class:"px-4 py-3 text-center"},Ct={class:"px-4 py-3"},St={class:"px-4 py-3"},$t={class:"flex items-center justify-center gap-2"},Et={class:"px-6 py-4 border-t border-border"},Ft=V({__name:"Index",props:{proxyRules:{},stats:{},filters:{}},setup(E){const m=E,{success:h,error:g}=Y(),l=f(m.proxyRules),u=f(m.stats);f(!1);const v=f(!1),i=D({search:m.filters?.search||"",status:m.filters?.status||""}),j=()=>{d.visit("/proxy/create")},M=o=>{d.visit(`/proxy/${o.id}/edit`)},B=async o=>{try{console.log("Tentando alterar status da regra:",o.id,"URL:",`/proxy/${o.id}/toggle`),await d.post(`/proxy/${o.id}/toggle`,{},{preserveState:!0,preserveScroll:!0,onSuccess:e=>{console.log("Sucesso ao alterar status:",e),e.success?(h(e.message||"Status alterado com sucesso!"),o.is_active=e.is_active):g(e.message||"Erro ao alterar status da regra")},onError:e=>{console.error("Erro ao alterar status:",e),g("Erro ao alterar status da regra")}})}catch(e){console.error("Exceção ao alterar status:",e),e("Erro ao alterar status da regra")}},N=o=>{window.open(o,"_blank","noopener,noreferrer")},b=o=>{const e=String(o.source_port).trim();return e==="443"||e==="8443"?"https":"http"},T=o=>{console.log("🔴 INÍCIO deleteProxy:",{id:o.id,source_host:o.source_host,url:`/proxy/${o.id}`}),confirm(`Tem certeza que deseja excluir a regra "${o.source_host}"?`)?(console.log("✅ Usuário confirmou exclusão"),console.log("📊 Estado ANTES da exclusão:",{total_rules:l.value.data.length,total_stats:u.value.total,active_stats:u.value.active,inactive_stats:u.value.inactive}),d.delete(`/proxy/${o.id}`,{onBefore:()=>(console.log("⏳ onBefore: Iniciando requisição DELETE"),!0),onStart:()=>{console.log("🚀 onStart: Requisição iniciada")},onProgress:e=>{console.log("📈 onProgress:",e)},onSuccess:e=>{console.log("✅ onSuccess chamado!",{page_data:e,response_type:typeof e}),h("Regra excluída com sucesso!"),setTimeout(()=>{console.log("🔄 Forçando reload completo da página..."),window.location.reload()},500)},onError:e=>{console.error("❌ onError chamado:",e),g("Erro ao excluir regra")},onFinish:()=>{console.log("🏁 onFinish: Requisição finalizada")}})):console.log("❌ Usuário cancelou exclusão")},A=async()=>{v.value=!0;try{await d.post("/proxy/deploy",{},{preserveState:!0,preserveScroll:!0,onSuccess:()=>{h("Configuração do Nginx aplicada com sucesso!")},onError:()=>{g("Erro ao aplicar configuração do Nginx")},onFinish:()=>{v.value=!1}})}catch(o){o("Erro ao aplicar configuração do Nginx"),v.value=!1}},P=()=>{i.search="",i.status="",k()},k=()=>{const o={search:i.search||void 0,status:i.status||void 0};d.get("/proxy",o,{preserveState:!0,preserveScroll:!0})},z=o=>{d.get("/proxy",{page:o},{preserveState:!0,preserveScroll:!0})};let C;const F=()=>{clearTimeout(C),C=setTimeout(k,500)},I=()=>{k()};return H(()=>{}),(o,e)=>(_(),U(Q,{title:"Proxy Reverso"},{default:a(()=>[r(W,null,{default:a(()=>[t("div",Z,[e[5]||(e[5]=t("div",null,[t("h1",{class:"text-2xl font-bold text-text"},"Regras de Proxy Reverso"),t("p",{class:"text-sm text-text-muted mt-1"}," Gerencie redirecionamentos de domínios para aplicações locais ")],-1)),t("div",tt,[r(c,{onClick:A,disabled:v.value,variant:"ghost"},{icon:a(()=>[...e[2]||(e[2]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1)])]),default:a(()=>[p(" "+n(v.value?"Aplicando...":"Aplicar Configuração"),1)]),_:1},8,["disabled"]),r(c,{onClick:j,class:"bg-accent hover:bg-accent-light"},{icon:a(()=>[...e[3]||(e[3]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1)])]),default:a(()=>[e[4]||(e[4]=p(" Nova Regra ",-1))]),_:1})])]),t("div",et,[r(x,{class:"p-4"},{default:a(()=>[t("div",st,[t("div",null,[e[6]||(e[6]=t("p",{class:"text-sm text-text-muted"},"Total",-1)),t("p",ot,n(u.value.total),1)]),e[7]||(e[7]=t("div",{class:"p-3 bg-muted/20 rounded-lg"},[t("svg",{class:"w-6 h-6 text-muted",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 9l4-4 4 4m0 6l-4 4-4-4"})])],-1))])]),_:1}),r(x,{class:"p-4"},{default:a(()=>[t("div",at,[t("div",null,[e[8]||(e[8]=t("p",{class:"text-sm text-text-muted"},"Ativas",-1)),t("p",rt,n(u.value.active),1)]),e[9]||(e[9]=t("div",{class:"p-3 bg-success/20 rounded-lg"},[t("svg",{class:"w-6 h-6 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4"})])],-1))])]),_:1}),r(x,{class:"p-4"},{default:a(()=>[t("div",nt,[t("div",null,[e[10]||(e[10]=t("p",{class:"text-sm text-text-muted"},"Inativas",-1)),t("p",it,n(u.value.inactive),1)]),e[11]||(e[11]=t("div",{class:"p-3 bg-danger/20 rounded-lg"},[t("svg",{class:"w-6 h-6 text-danger",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})])],-1))])]),_:1}),r(x,{class:"p-4"},{default:a(()=>[...e[12]||(e[12]=[t("div",{class:"flex items-center justify-between"},[t("div",null,[t("p",{class:"text-sm text-text-muted"},"Nginx Status"),t("p",{class:"text-sm font-medium text-success"},"Operacional")]),t("div",{class:"p-3 bg-success/20 rounded-lg"},[t("svg",{class:"w-6 h-6 text-success",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 12h14M5 12a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2M5 12a2 2 0 00-2 2v4a2 2 0 002 2h14a2 2 0 002-2v-4a2 2 0 00-2-2"})])])],-1)])]),_:1})]),r(x,{class:"p-4 mb-6"},{default:a(()=>[t("div",lt,[t("div",dt,[S(t("input",{"onUpdate:modelValue":e[0]||(e[0]=s=>i.search=s),onInput:F,type:"text",placeholder:"Buscar por domínio, target...",class:"w-full px-3 py-2 bg-elevated border border-border rounded-lg text-text placeholder-text-muted focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"},null,544),[[q,i.search]])]),t("div",ct,[S(t("select",{"onUpdate:modelValue":e[1]||(e[1]=s=>i.status=s),onChange:I,class:"px-3 py-2 bg-elevated border border-border rounded-lg text-text focus:outline-none focus:ring-2 focus:ring-accent focus:border-transparent"},[...e[13]||(e[13]=[t("option",{value:""},"Todos os status",-1),t("option",{value:"1"},"Ativo",-1),t("option",{value:"0"},"Inativo",-1)])],544),[[O,i.status]]),r(c,{onClick:P,variant:"ghost"},{default:a(()=>[...e[14]||(e[14]=[p("Limpar",-1)])]),_:1})])])]),_:1}),r(x,null,{default:a(()=>[t("div",ut,[t("table",pt,[e[19]||(e[19]=t("thead",{class:"bg-muted/20 border-b border-border"},[t("tr",null,[t("th",{class:"px-4 py-3 text-left text-sm font-medium text-text"},"Origem"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-text"},"Destino"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-text"},"Domínio"),t("th",{class:"px-4 py-3 text-center text-sm font-medium text-text"},"Prioridade"),t("th",{class:"px-4 py-3 text-left text-sm font-medium text-text"},"Status"),t("th",{class:"px-4 py-3 text-center text-sm font-medium text-text"},"Ações")])],-1)),t("tbody",xt,[l.value.data.length===0?(_(),w("tr",vt,[...e[15]||(e[15]=[t("td",{colspan:"6",class:"px-4 py-8 text-center text-text-muted"}," Nenhuma regra de proxy encontrada ",-1)])])):R("",!0),(_(!0),w(G,null,J(l.value.data,(s,L)=>(_(),w("tr",{key:s.id,class:K({"bg-muted/10":L%2===1})},[t("td",mt,[t("div",gt,[t("div",ft,n(b(s))+"://"+n(s.source_host)+":"+n(s.source_port),1),r(c,{onClick:y=>N(`${b(s)}://${s.source_host}:${s.source_port}`),variant:"ghost",size:"sm",class:"p-1",title:"Abrir endereço em nova aba"},{icon:a(()=>[...e[16]||(e[16]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})],-1)])]),_:2},1032,["onClick"])])]),t("td",_t,[t("div",ht,n(s.protocol)+"://"+n(s.target_host)+":"+n(s.target_port),1)]),t("td",kt,[t("div",yt,n(s.domain?.name||"N/A"),1),t("div",wt,n(s.domain?.description||""),1)]),t("td",bt,[r($,{variant:"neutral"},{default:a(()=>[p(n(s.priority),1)]),_:2},1024)]),t("td",Ct,[r($,{variant:s.is_active?"positive":"negative"},{default:a(()=>[p(n(s.is_active?"Ativo":"Inativo"),1)]),_:2},1032,["variant"])]),t("td",St,[t("div",$t,[r(c,{onClick:y=>B(s),variant:s.is_active?"outline":"default",size:"sm"},{default:a(()=>[p(n(s.is_active?"Desativar":"Ativar"),1)]),_:2},1032,["onClick","variant"]),r(c,{onClick:y=>M(s),variant:"ghost",size:"sm"},{icon:a(()=>[...e[17]||(e[17]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])]),_:2},1032,["onClick"]),r(c,{onClick:y=>T(s),variant:"danger",size:"sm"},{icon:a(()=>[...e[18]||(e[18]=[t("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])]),_:2},1032,["onClick"])])])],2))),128))])])]),t("div",Et,[r(X,{"current-page":l.value.current_page,"total-pages":l.value.last_page,"total-items":l.value.total,"per-page":l.value.per_page,onNavigate:z},null,8,["current-page","total-pages","total-items","per-page"])])]),_:1})]),_:1})]),_:1}))}});export{Ft as default};
