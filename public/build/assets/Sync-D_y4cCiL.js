import{d as u,e as j,p as A,o as c,j as P,a as s,c as l,b,t as v,x as L,q}from"./app-DPCJlmDy.js";import{_ as F}from"./AppLayout.vue_vue_type_script_setup_true_lang-Bt_ij8e5.js";/* empty css            */class f{listenForWhisper(e,t){return this.listen(".client-"+e,t)}notification(e){return this.listen(".Illuminate\\Notifications\\Events\\BroadcastNotificationCreated",e)}stopListeningForWhisper(e,t){return this.stopListening(".client-"+e,t)}}class w{constructor(e){this.namespace=e}format(e){return[".","\\"].includes(e.charAt(0))?e.substring(1):(this.namespace&&(e=this.namespace+"."+e),e.replace(/\./g,"\\"))}setNamespace(e){this.namespace=e}}function O(i){try{new i}catch(e){if(e instanceof Error&&e.message.includes("is not a constructor"))return!1}return!0}class m extends f{constructor(e,t,n){super(),this.name=t,this.pusher=e,this.options=n,this.eventFormatter=new w(this.options.namespace),this.subscribe()}subscribe(){this.subscription=this.pusher.subscribe(this.name)}unsubscribe(){this.pusher.unsubscribe(this.name)}listen(e,t){return this.on(this.eventFormatter.format(e),t),this}listenToAll(e){return this.subscription.bind_global((t,n)=>{if(t.startsWith("pusher:"))return;let o=String(this.options.namespace??"").replace(/\./g,"\\"),a=t.startsWith(o)?t.substring(o.length+1):"."+t;e(a,n)}),this}stopListening(e,t){return t?this.subscription.unbind(this.eventFormatter.format(e),t):this.subscription.unbind(this.eventFormatter.format(e)),this}stopListeningToAll(e){return e?this.subscription.unbind_global(e):this.subscription.unbind_global(),this}subscribed(e){return this.on("pusher:subscription_succeeded",()=>{e()}),this}error(e){return this.on("pusher:subscription_error",t=>{e(t)}),this}on(e,t){return this.subscription.bind(e,t),this}}class x extends m{whisper(e,t){return this.pusher.channels.channels[this.name].trigger(`client-${e}`,t),this}}class B extends m{whisper(e,t){return this.pusher.channels.channels[this.name].trigger(`client-${e}`,t),this}}class R extends x{here(e){return this.on("pusher:subscription_succeeded",t=>{e(Object.keys(t.members).map(n=>t.members[n]))}),this}joining(e){return this.on("pusher:member_added",t=>{e(t.info)}),this}whisper(e,t){return this.pusher.channels.channels[this.name].trigger(`client-${e}`,t),this}leaving(e){return this.on("pusher:member_removed",t=>{e(t.info)}),this}}class k extends f{constructor(e,t,n){super(),this.events={},this.listeners={},this.name=t,this.socket=e,this.options=n,this.eventFormatter=new w(this.options.namespace),this.subscribe()}subscribe(){this.socket.emit("subscribe",{channel:this.name,auth:this.options.auth||{}})}unsubscribe(){this.unbind(),this.socket.emit("unsubscribe",{channel:this.name,auth:this.options.auth||{}})}listen(e,t){return this.on(this.eventFormatter.format(e),t),this}stopListening(e,t){return this.unbindEvent(this.eventFormatter.format(e),t),this}subscribed(e){return this.on("connect",t=>{e(t)}),this}error(e){return this}on(e,t){return this.listeners[e]=this.listeners[e]||[],this.events[e]||(this.events[e]=(n,o)=>{this.name===n&&this.listeners[e]&&this.listeners[e].forEach(a=>a(o))},this.socket.on(e,this.events[e])),this.listeners[e].push(t),this}unbind(){Object.keys(this.events).forEach(e=>{this.unbindEvent(e)})}unbindEvent(e,t){this.listeners[e]=this.listeners[e]||[],t&&(this.listeners[e]=this.listeners[e].filter(n=>n!==t)),(!t||this.listeners[e].length===0)&&(this.events[e]&&(this.socket.removeListener(e,this.events[e]),delete this.events[e]),delete this.listeners[e])}}class _ extends k{whisper(e,t){return this.socket.emit("client event",{channel:this.name,event:`client-${e}`,data:t}),this}}class $ extends _{here(e){return this.on("presence:subscribed",t=>{e(t.map(n=>n.user_info))}),this}joining(e){return this.on("presence:joining",t=>e(t.user_info)),this}whisper(e,t){return this.socket.emit("client event",{channel:this.name,event:`client-${e}`,data:t}),this}leaving(e){return this.on("presence:leaving",t=>e(t.user_info)),this}}class d extends f{subscribe(){}unsubscribe(){}listen(e,t){return this}listenToAll(e){return this}stopListening(e,t){return this}subscribed(e){return this}error(e){return this}on(e,t){return this}}class S extends d{whisper(e,t){return this}}class V extends d{whisper(e,t){return this}}class z extends S{here(e){return this}joining(e){return this}whisper(e,t){return this}leaving(e){return this}}const C=class I{constructor(e){this.setOptions(e),this.connect()}setOptions(e){this.options={...I._defaultOptions,...e,broadcaster:e.broadcaster};let t=this.csrfToken();t&&(this.options.auth.headers["X-CSRF-TOKEN"]=t,this.options.userAuthentication.headers["X-CSRF-TOKEN"]=t),t=this.options.bearerToken,t&&(this.options.auth.headers.Authorization="Bearer "+t,this.options.userAuthentication.headers.Authorization="Bearer "+t)}csrfToken(){var e,t;return typeof window<"u"&&(e=window.Laravel)!=null&&e.csrfToken?window.Laravel.csrfToken:this.options.csrfToken?this.options.csrfToken:typeof document<"u"&&typeof document.querySelector=="function"?((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))??null:null}};C._defaultOptions={auth:{headers:{}},authEndpoint:"/broadcasting/auth",userAuthentication:{endpoint:"/broadcasting/user-auth",headers:{}},csrfToken:null,bearerToken:null,host:null,key:null,namespace:"App.Events"};let g=C;class p extends g{constructor(){super(...arguments),this.channels={}}connect(){if(typeof this.options.client<"u")this.pusher=this.options.client;else if(this.options.Pusher)this.pusher=new this.options.Pusher(this.options.key,this.options);else if(typeof window<"u"&&typeof window.Pusher<"u")this.pusher=new window.Pusher(this.options.key,this.options);else throw new Error("Pusher client not found. Should be globally available or passed via options.client")}signin(){this.pusher.signin()}listen(e,t,n){return this.channel(e).listen(t,n)}channel(e){return this.channels[e]||(this.channels[e]=new m(this.pusher,e,this.options)),this.channels[e]}privateChannel(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new x(this.pusher,"private-"+e,this.options)),this.channels["private-"+e]}encryptedPrivateChannel(e){return this.channels["private-encrypted-"+e]||(this.channels["private-encrypted-"+e]=new B(this.pusher,"private-encrypted-"+e,this.options)),this.channels["private-encrypted-"+e]}presenceChannel(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new R(this.pusher,"presence-"+e,this.options)),this.channels["presence-"+e]}leave(e){[e,"private-"+e,"private-encrypted-"+e,"presence-"+e].forEach(t=>{this.leaveChannel(t)})}leaveChannel(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}socketId(){return this.pusher.connection.socket_id}disconnect(){this.pusher.disconnect()}}class N extends g{constructor(){super(...arguments),this.channels={}}connect(){let e=this.getSocketIO();this.socket=e(this.options.host??void 0,this.options),this.socket.io.on("reconnect",()=>{Object.values(this.channels).forEach(t=>{t.subscribe()})})}getSocketIO(){if(typeof this.options.client<"u")return this.options.client;if(typeof window<"u"&&typeof window.io<"u")return window.io;throw new Error("Socket.io client not found. Should be globally available or passed via options.client")}listen(e,t,n){return this.channel(e).listen(t,n)}channel(e){return this.channels[e]||(this.channels[e]=new k(this.socket,e,this.options)),this.channels[e]}privateChannel(e){return this.channels["private-"+e]||(this.channels["private-"+e]=new _(this.socket,"private-"+e,this.options)),this.channels["private-"+e]}presenceChannel(e){return this.channels["presence-"+e]||(this.channels["presence-"+e]=new $(this.socket,"presence-"+e,this.options)),this.channels["presence-"+e]}leave(e){[e,"private-"+e,"presence-"+e].forEach(t=>{this.leaveChannel(t)})}leaveChannel(e){this.channels[e]&&(this.channels[e].unsubscribe(),delete this.channels[e])}socketId(){return this.socket.id}disconnect(){this.socket.disconnect()}}class y extends g{constructor(){super(...arguments),this.channels={}}connect(){}listen(e,t,n){return new d}channel(e){return new d}privateChannel(e){return new S}encryptedPrivateChannel(e){return new V}presenceChannel(e){return new z}leave(e){}leaveChannel(e){}socketId(){return"fake-socket-id"}disconnect(){}}class X{constructor(e){this.options=e,this.connect(),this.options.withoutInterceptors||this.registerInterceptors()}channel(e){return this.connector.channel(e)}connect(){if(this.options.broadcaster==="reverb")this.connector=new p({...this.options,cluster:""});else if(this.options.broadcaster==="pusher")this.connector=new p(this.options);else if(this.options.broadcaster==="ably")this.connector=new p({...this.options,cluster:"",broadcaster:"pusher"});else if(this.options.broadcaster==="socket.io")this.connector=new N(this.options);else if(this.options.broadcaster==="null")this.connector=new y(this.options);else if(typeof this.options.broadcaster=="function"&&O(this.options.broadcaster))this.connector=new this.options.broadcaster(this.options);else throw new Error(`Broadcaster ${typeof this.options.broadcaster} ${String(this.options.broadcaster)} is not supported.`)}disconnect(){this.connector.disconnect()}join(e){return this.connector.presenceChannel(e)}leave(e){this.connector.leave(e)}leaveChannel(e){this.connector.leaveChannel(e)}leaveAllChannels(){for(const e in this.connector.channels)this.leaveChannel(e)}listen(e,t,n){return this.connector.listen(e,t,n)}private(e){return this.connector.privateChannel(e)}encryptedPrivate(e){if(this.connectorSupportsEncryptedPrivateChannels(this.connector))return this.connector.encryptedPrivateChannel(e);throw new Error(`Broadcaster ${typeof this.options.broadcaster} ${String(this.options.broadcaster)} does not support encrypted private channels.`)}connectorSupportsEncryptedPrivateChannels(e){return e instanceof p||e instanceof y}socketId(){return this.connector.socketId()}registerInterceptors(){typeof Vue<"u"&&Vue!=null&&Vue.http&&this.registerVueRequestInterceptor(),typeof axios=="function"&&this.registerAxiosRequestInterceptor(),typeof jQuery=="function"&&this.registerjQueryAjaxSetup(),typeof Turbo=="object"&&this.registerTurboRequestInterceptor()}registerVueRequestInterceptor(){Vue.http.interceptors.push((e,t)=>{this.socketId()&&e.headers.set("X-Socket-ID",this.socketId()),t()})}registerAxiosRequestInterceptor(){axios.interceptors.request.use(e=>(this.socketId()&&(e.headers["X-Socket-Id"]=this.socketId()),e))}registerjQueryAjaxSetup(){typeof jQuery.ajax<"u"&&jQuery.ajaxPrefilter((e,t,n)=>{this.socketId()&&n.setRequestHeader("X-Socket-Id",this.socketId())})}registerTurboRequestInterceptor(){document.addEventListener("turbo:before-fetch-request",e=>{e.detail.fetchOptions.headers["X-Socket-Id"]=this.socketId()})}}const Q={class:"px-4 py-6 sm:px-0"},M={class:"bg-white shadow rounded-lg"},W={class:"px-4 py-5 sm:p-6"},D={class:"mt-5"},H=["disabled"],K={key:0,class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},Y={key:1},G={key:2},U={key:0,class:"mt-4"},J={class:"flex justify-between text-sm text-gray-600 mb-1"},Z={class:"w-full bg-gray-200 rounded-full h-2.5"},ee={key:0,class:"mt-6 bg-white shadow rounded-lg"},te={class:"px-4 py-5 sm:p-6"},se={class:"mt-2"},ne={class:"bg-gray-50 rounded-md p-4"},ie={class:"flex"},re={class:"ml-3"},oe={class:"mt-2 text-sm text-green-700"},he={class:"whitespace-pre-wrap"},ue={__name:"Sync",setup(i){const e=u(0),t=u(""),n=u(""),o=u(!1),a=new X({broadcaster:"pusher",key:void 0,cluster:void 0,forceTLS:!0});j(()=>{a.channel("sync-progress").listen("SyncProgress",h=>{e.value=h.progress,t.value=h.message,h.progress===100&&setTimeout(()=>{e.value=0,t.value=""},2e3)})});function E(){o.value=!0,n.value="",e.value=0,t.value="",q.post("/sync",{},{onSuccess:h=>{const r=h.props?.flash?.success,T=h.props?.flash?.error;n.value=r||T||"Sync completed."},onFinish:()=>o.value=!1,preserveScroll:!0,preserveState:!0})}return(h,r)=>(c(),A(F,null,{default:P(()=>[s("div",Q,[r[6]||(r[6]=s("div",{class:"mb-8"},[s("h1",{class:"text-2xl font-semibold text-gray-900"},"Sync Configuration"),s("p",{class:"mt-2 text-sm text-gray-600"},"Generate Traefik dynamic config from database and sync proxy settings.")],-1)),s("div",M,[s("div",W,[r[1]||(r[1]=s("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Proxy Synchronization",-1)),r[2]||(r[2]=s("div",{class:"mt-2 max-w-xl text-sm text-gray-500"},[s("p",null,"This will generate YAML configuration files for Traefik based on your current domains, routes, and redirects.")],-1)),s("div",D,[s("button",{onClick:E,disabled:o.value,class:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},[o.value?(c(),l("svg",K,[...r[0]||(r[0]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):b("",!0),o.value?(c(),l("span",Y,"Syncing Configuration...")):(c(),l("span",G,"Run Sync"))],8,H)]),e.value>0?(c(),l("div",U,[s("div",J,[s("span",null,v(t.value),1),s("span",null,v(e.value)+"%",1)]),s("div",Z,[s("div",{class:"bg-blue-600 h-2.5 rounded-full",style:L({width:e.value+"%"})},null,4)])])):b("",!0)])]),n.value?(c(),l("div",ee,[s("div",te,[r[5]||(r[5]=s("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Sync Results",-1)),s("div",se,[s("div",ne,[s("div",ie,[r[4]||(r[4]=s("div",{class:"flex-shrink-0"},[s("svg",{class:"h-5 w-5 text-green-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z","clip-rule":"evenodd"})])],-1)),s("div",re,[r[3]||(r[3]=s("h3",{class:"text-sm font-medium text-green-800"},"Configuration Updated",-1)),s("div",oe,[s("pre",he,v(n.value),1)])])])])])])])):b("",!0),r[7]||(r[7]=s("div",{class:"mt-6 bg-blue-50 border border-blue-200 rounded-lg"},[s("div",{class:"px-4 py-5 sm:p-6"},[s("h3",{class:"text-lg leading-6 font-medium text-blue-900"},"Next Steps"),s("div",{class:"mt-2 text-sm text-blue-700"},[s("p",null,"After syncing, Traefik will automatically reload the configuration. You can monitor the process with:"),s("code",{class:"mt-2 block bg-blue-100 px-3 py-2 rounded text-blue-800"},"./vendor/bin/sail artisan proxy:logs --follow")])])],-1))])]),_:1}))}};export{ue as default};
