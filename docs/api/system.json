{
  "openapi": "3.0.3",
  "info": {
    "title": "NetPilot System API",
    "description": "API endpoints for system health, metrics, and status monitoring",
    "version": "1.0.0"
  },
  "servers": [
    {"url": "http://localhost:3001/api/v1", "description": "Development"},
    {"url": "https://api.seudominio.com/api/v1", "description": "Production"}
  ],
  "tags": [
    {"name": "System", "description": "System monitoring and health checks"},
    {"name": "Dashboard", "description": "Dashboard metrics and statistics"}
  ],
  "paths": {
    "/health": {
      "get": {
        "tags": ["System"],
        "summary": "Health check",
        "operationId": "healthCheck",
        "responses": {
          "200": {
            "description": "System is healthy",
            "content": {
              "application/json": {
                "schema": {"$ref": "#/components/schemas/HealthCheckResponse"}
              }
            }
          }
        }
      }
    },
    "/system/status": {
      "get": {
        "tags": ["System"],
        "summary": "System status",
        "operationId": "getSystemStatus",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "System status retrieved",
            "content": {
              "application/json": {
                "schema": {"$ref": "#/components/schemas/SystemStatusResponse"}
              }
            }
          }
        }
      }
    },
    "/system/metrics": {
      "get": {
        "tags": ["System"],
        "summary": "Prometheus metrics",
        "operationId": "getMetrics",
        "security": [{"bearerAuth": []}],
        "responses": {
          "200": {
            "description": "Metrics in Prometheus format",
            "content": {
              "text/plain": {
                "schema": {"type": "string"}
              }
            }
          }
        }
      }
    },
    "/dashboard/stats": {
      "get": {
        "tags": ["Dashboard"],
        "summary": "Dashboard statistics",
        "operationId": "getDashboardStats",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name": "period", "in": "query", "schema": {"type": "string", "enum": ["24h", "7d", "30d", "90d"], "default": "24h"}}
        ],
        "responses": {
          "200": {
            "description": "Dashboard statistics",
            "content": {
              "application/json": {
                "schema": {"$ref": "#/components/schemas/DashboardStatsResponse"}
              }
            }
          }
        }
      }
    },
    "/dashboard/traffic": {
      "get": {
        "tags": ["Dashboard"],
        "summary": "Traffic analytics",
        "operationId": "getTrafficAnalytics",
        "security": [{"bearerAuth": []}],
        "parameters": [
          {"name": "period", "in": "query", "schema": {"type": "string", "enum": ["24h", "7d", "30d"], "default": "24h"}},
          {"name": "domain_id", "in": "query", "schema": {"type": "integer"}},
          {"name": "group_by", "in": "query", "schema": {"type": "string", "enum": ["hour", "day", "week"], "default": "hour"}}
        ],
        "responses": {
          "200": {
            "description": "Traffic analytics data",
            "content": {
              "application/json": {
                "schema": {"$ref": "#/components/schemas/TrafficAnalyticsResponse"}
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "securitySchemes": {
      "bearerAuth": {"type": "http", "scheme": "bearer", "bearerFormat": "JWT"}
    },
    "schemas": {
      "HealthCheckResponse": {
        "type": "object",
        "properties": {
          "status": {"type": "string", "example": "ok"},
          "timestamp": {"type": "string", "format": "date-time"},
          "uptime": {"type": "integer", "description": "Uptime in seconds"},
          "version": {"type": "string"},
          "checks": {
            "type": "object",
            "properties": {
              "database": {"$ref": "#/components/schemas/HealthCheck"},
              "redis": {"$ref": "#/components/schemas/HealthCheck"},
              "traefik": {"$ref": "#/components/schemas/HealthCheck"},
              "nginx": {"$ref": "#/components/schemas/HealthCheck"}
            }
          }
        }
      },
      "HealthCheck": {
        "type": "object",
        "properties": {
          "status": {"type": "string", "enum": ["ok", "error"]},
          "response_time_ms": {"type": "integer"},
          "error": {"type": "string", "nullable": true}
        }
      },
      "SystemStatusResponse": {
        "type": "object",
        "properties": {
          "system": {
            "type": "object",
            "properties": {
              "hostname": {"type": "string"},
              "platform": {"type": "string"},
              "arch": {"type": "string"},
              "uptime": {"type": "integer"},
              "load_average": {"type": "array", "items": {"type": "number"}}
            }
          },
          "application": {
            "type": "object",
            "properties": {
              "version": {"type": "string"},
              "environment": {"type": "string"},
              "node_version": {"type": "string"},
              "started_at": {"type": "string", "format": "date-time"}
            }
          },
          "resources": {
            "type": "object",
            "properties": {
              "cpu": {"type": "object", "properties": {"usage_percentage": {"type": "number"}, "cores": {"type": "integer"}}},
              "memory": {"type": "object", "properties": {"usage_percentage": {"type": "number"}, "total_gb": {"type": "number"}, "used_gb": {"type": "number"}}},
              "disk": {"type": "object", "properties": {"usage_percentage": {"type": "number"}, "total_gb": {"type": "number"}, "used_gb": {"type": "number"}}}
            }
          }
        }
      },
      "DashboardStatsResponse": {
        "type": "object",
        "properties": {
          "period": {"type": "string"},
          "domains": {
            "type": "object",
            "properties": {
              "total": {"type": "integer"},
              "active": {"type": "integer"},
              "inactive": {"type": "integer"},
              "with_ssl": {"type": "integer"},
              "ssl_expiring_soon": {"type": "integer"}
            }
          },
          "proxy_rules": {
            "type": "object",
            "properties": {
              "total": {"type": "integer"},
              "active": {"type": "integer"},
              "inactive": {"type": "integer"}
            }
          },
          "ssl_certificates": {
            "type": "object",
            "properties": {
              "total": {"type": "integer"},
              "active": {"type": "integer"},
              "expired": {"type": "integer"},
              "expiring_30_days": {"type": "integer"}
            }
          },
          "traffic": {
            "type": "object",
            "properties": {
              "total_requests": {"type": "integer"},
              "unique_visitors": {"type": "integer"},
              "bandwidth_gb": {"type": "number"},
              "avg_response_time_ms": {"type": "number"}
            }
          }
        }
      },
      "TrafficAnalyticsResponse": {
        "type": "object",
        "properties": {
          "period": {"type": "string"},
          "group_by": {"type": "string"},
          "data": {
            "type": "array",
            "items": {
              "type": "object",
              "properties": {
                "timestamp": {"type": "string", "format": "date-time"},
                "requests": {"type": "integer"},
                "unique_visitors": {"type": "integer"},
                "bandwidth_mb": {"type": "number"},
                "avg_response_time_ms": {"type": "number"},
                "status_codes": {
                  "type": "object",
                  "properties": {
                    "2xx": {"type": "integer"},
                    "3xx": {"type": "integer"},
                    "4xx": {"type": "integer"},
                    "5xx": {"type": "integer"}
                  }
                }
              }
            }
          }
        }
      }
    }
  }
}